var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,n=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,a=(e,a)=>{for(var c in a||(a={}))t.call(a,c)&&n(e,c,a[c]);if(o)for(var c of o(a))r.call(a,c)&&n(e,c,a[c]);return e};import{r as c,B as s,I as u,c as l,a as d}from"./vendor.63265cf6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const r=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,a)=>{const c=new URL(e,r);if(self[t].moduleMap[c])return o(self[t].moduleMap[c]);const s=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),u=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){a(new Error(`Failed to import: ${e}`)),n(u)},onload(){o(self[t].moduleMap[c]),n(u)}});document.head.appendChild(u)})),self[t].moduleMap={}}}("/LuBan/assets/");function i({top:e,left:t,component:o}){return{top:e,left:t,componentKey:o.key,adjustPostion:!0,focus:!1}}const m=function(){const e={},t=[];return{componentMap:e,componentArray:t,registryComponent:function(o,r){if(e[o]){const r=t.indexOf(e[o]);t.splice(r,1)}const n=a({key:o},r);t.push(n),e[o]=n}}}();m.registryComponent("text",{name:"文本",preview:()=>c.createElement("span",null,"预览文本"),render:()=>c.createElement("span",null,"预览文本")}),m.registryComponent("button",{name:"按钮",preview:()=>c.createElement(s,{type:"primary"},"预览按钮"),render:()=>c.createElement(s,{type:"primary"},"预览按钮")}),m.registryComponent("input",{name:"输入框",preview:()=>c.createElement(u,null),render:()=>c.createElement(u,null)});const p=e=>{const{block:t,config:o,onMouseDown:r}=e,{forceUpdate:n}=function(){const[e,t]=c.useState(0);return c.useMemo((()=>({forceUpdate:()=>t(e+1)})),[e])}(),a=c.useRef({});c.useEffect((()=>{if(t.adjustPostion){const{height:e,width:o}=a.current.getBoundingClientRect();t.adjustPostion=!1,t.top=t.top-e/2,t.left=t.left-o/2,n()}}),[]);const s=c.useMemo((()=>({top:`${t.top}px`,left:`${t.left}px`,opacity:t.adjustPostion?"0":""})),[t.left,t.top,t.adjustPostion]),u=c.useMemo((()=>l(["editor-block",{"editor-block-focus":t.focus}])),[t.focus]),d=o.componentMap[t.componentKey];let i;return d&&(i=d.render()),c.createElement("div",{className:u,style:s,ref:a,onMouseDown:r},i)};function f(e){const t=c.useRef(e);return t.current=e,c.useCallback(((...e)=>t.current(...e)),[])}const v=e=>{const{config:t,value:o,onChange:r}=e,n=c.useRef({}),s=c.useMemo((()=>({width:o.container.width,height:o.container.height})),[o.container.height,o.container.width]),u=c.useMemo((()=>{const e=[],t=[];return o.blocks.forEach((o=>{(o.focus?e:t).push(o)})),{focus:e,unFocus:t}}),[o.blocks]),l={updateBlocks:e=>{r(a(a({},o),{blocks:[...e]}))},clearFocus:e=>{(e?u.focus.filter((t=>t!==e)):u.focus).forEach((e=>{e.focus=!1})),l.updateBlocks(o.blocks)}},d=(()=>{const e=c.useRef({dragComponent:null}),t={dragenter:f((e=>{e.dataTransfer.dropEffect="move"})),dragover:f((e=>{e.preventDefault()})),dragleave:f((e=>{e.dataTransfer.dropEffect="none"})),drop:f((t=>{r(a(a({},o),{blocks:[...o.blocks,i({top:t.offsetY,left:t.offsetX,component:e.current.dragComponent})]}))}))};return{dragStart:f(((o,r)=>{n.current.addEventListener("dragenter",t.dragenter),n.current.addEventListener("dragover",t.dragover),n.current.addEventListener("dragleave",t.dragleave),n.current.addEventListener("drop",t.drop),e.current.dragComponent=r})),dragEnd:f((e=>{n.current.removeEventListener("dragenter",t.dragenter),n.current.removeEventListener("dragover",t.dragover),n.current.removeEventListener("dragleave",t.dragleave),n.current.removeEventListener("drop",t.drop)}))}})(),m={block:(e,t)=>{e.shiftKey?(u.focus.length<=1?t.focus=!0:t.focus=!t.focus,l.updateBlocks(o.blocks)):t.focus||(t.focus=!0,l.clearFocus(t)),setTimeout((()=>v.mousedown(e)))},container:e=>{e.target===e.currentTarget&&(e.shiftKey||l.clearFocus())}},v=(()=>{const e=c.useRef({startX:0,startY:0,startPosArray:[]}),t=f((t=>{document.addEventListener("mousemove",r),document.addEventListener("mouseup",n),e.current={startX:t.clientX,startY:t.clientY,startPosArray:u.focus.map((({top:e,left:t})=>({top:e,left:t})))}})),r=f((t=>{const{startX:r,startY:n,startPosArray:a}=e.current,{clientX:c,clientY:s}=t,d=s-n,i=c-r;u.focus.forEach(((e,t)=>{const{top:o,left:r}=a[t];e.top=o+d,e.left=r+i})),l.updateBlocks(o.blocks)})),n=f((e=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n)}));return{mousedown:t}})();return c.createElement("div",{className:"editor"},c.createElement("div",{className:"editor-menu"},t.componentArray.map(((e,t)=>c.createElement("div",{className:"editor-menu-item",key:t,draggable:!0,onDragStart:t=>d.dragStart(t,e),onDragEnd:d.dragEnd},c.createElement("div",{className:"editor-menu-item-name"},e.name),e.preview())))),c.createElement("div",{className:"editor-head"},"head"),c.createElement("div",{className:"editor-operator"},"operator"),c.createElement("div",{className:"editor-body"},c.createElement("div",{className:"editor-container",style:s,ref:n,onMouseDown:m.container},o.blocks.map(((e,o)=>c.createElement(p,{key:o,block:e,config:t,onMouseDown:t=>m.block(t,e)}))))))};function g(){const[e,t]=c.useState({container:{height:700,width:1e3},blocks:[{componentKey:"text",top:100,left:100,adjustPostion:!0,focus:!1},{componentKey:"button",top:200,left:200,adjustPostion:!0,focus:!1},{componentKey:"input",top:300,left:300,adjustPostion:!0,focus:!1}]});return c.createElement("div",{className:"app-home"},c.createElement(v,{value:e,config:m,onChange:t}))}d.render(c.createElement(c.StrictMode,null,c.createElement(g,null)),document.getElementById("root"));

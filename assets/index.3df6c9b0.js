var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,a)=>{for(var c in a||(a={}))t.call(a,c)&&o(e,c,a[c]);if(r)for(var c of r(a))n.call(a,c)&&o(e,c,a[c]);return e};import{r as c,B as s,I as l,a as d}from"./vendor.6b8ccad2.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(r){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((r,a)=>{const c=new URL(e,n);if(self[t].moduleMap[c])return r(self[t].moduleMap[c]);const s=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){a(new Error(`Failed to import: ${e}`)),o(l)},onload(){r(self[t].moduleMap[c]),o(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/LuBan/assets/");function i({top:e,left:t,component:r}){return{top:e,left:t,componentKey:r.key,adjustPostion:!0}}const m=function(){const e={},t=[];return{componentMap:e,componentArray:t,registryComponent:function(r,n){if(e[r]){const n=t.indexOf(e[r]);t.splice(n,1)}const o=a({key:r},n);t.push(o),e[r]=o}}}();m.registryComponent("text",{name:"文本",preview:()=>c.createElement("span",null,"预览文本"),render:()=>c.createElement("span",null,"预览文本")}),m.registryComponent("button",{name:"按钮",preview:()=>c.createElement(s,{type:"primary"},"预览按钮"),render:()=>c.createElement(s,{type:"primary"},"预览按钮")}),m.registryComponent("input",{name:"输入框",preview:()=>c.createElement(l,null),render:()=>c.createElement(l,null)});const p=e=>{const{block:t,config:r}=e,{forceUpdate:n}=function(){const[e,t]=c.useState(0);return c.useMemo((()=>({forceUpdate:()=>t(e+1)})),[e])}(),o=c.useRef({});c.useEffect((()=>{if(t.adjustPostion){const{height:e,width:r}=o.current.getBoundingClientRect();t.adjustPostion=!1,t.top=t.top-e/2,t.left=t.left-r/2,n()}}),[]);const a=c.useMemo((()=>({top:`${t.top}px`,left:`${t.left}px`,opacity:t.adjustPostion?"0":""})),[t.left,t.top,t.adjustPostion]),s=r.componentMap[t.componentKey];let l;return s&&(l=s.render()),c.createElement("div",{className:"editor-block",style:a,ref:o},l)};function u(e){const t=c.useRef(e);return t.current=e,c.useCallback(((...e)=>t.current(...e)),[])}const f=e=>{const{config:t,value:r,onChange:n}=e,o=c.useRef({}),s=c.useMemo((()=>({width:r.container.width,height:r.container.height})),[r.container.height,r.container.width]),l=(()=>{const e=c.useRef({dragComponent:null}),t={dragenter:u((e=>{e.dataTransfer.dropEffect="move"})),dragover:u((e=>{e.preventDefault()})),dragleave:u((e=>{e.dataTransfer.dropEffect="none"})),drop:u((t=>{n(a(a({},r),{blocks:[...r.blocks,i({top:t.offsetY,left:t.offsetX,component:e.current.dragComponent})]}))}))};return{dragStart:u(((r,n)=>{o.current.addEventListener("dragenter",t.dragenter),o.current.addEventListener("dragover",t.dragover),o.current.addEventListener("dragleave",t.dragleave),o.current.addEventListener("drop",t.drop),e.current.dragComponent=n})),dragEnd:u((e=>{o.current.removeEventListener("dragenter",t.dragenter),o.current.removeEventListener("dragover",t.dragover),o.current.removeEventListener("dragleave",t.dragleave),o.current.removeEventListener("drop",t.drop)}))}})();return c.createElement("div",{className:"editor"},c.createElement("div",{className:"editor-menu"},t.componentArray.map(((e,t)=>c.createElement("div",{className:"editor-menu-item",key:t,draggable:!0,onDragStart:t=>l.dragStart(t,e),onDragEnd:l.dragEnd},c.createElement("div",{className:"editor-menu-item-name"},e.name),e.preview())))),c.createElement("div",{className:"editor-head"},"head"),c.createElement("div",{className:"editor-operator"},"operator"),c.createElement("div",{className:"editor-body"},c.createElement("div",{className:"editor-container",style:s,ref:o},r.blocks.map(((e,r)=>c.createElement(p,{key:r,block:e,config:t}))))))};function v(){const[e,t]=c.useState({container:{height:700,width:1e3},blocks:[{componentKey:"text",top:100,left:100,adjustPostion:!0},{componentKey:"button",top:200,left:200,adjustPostion:!0},{componentKey:"input",top:300,left:300,adjustPostion:!0}]});return c.createElement("div",{className:"app-home"},c.createElement(f,{value:e,config:m,onChange:t}))}d.render(c.createElement(c.StrictMode,null,c.createElement(v,null)),document.getElementById("root"));
